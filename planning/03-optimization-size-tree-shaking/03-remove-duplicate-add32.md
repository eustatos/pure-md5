# Задача 3: Устранение дублирования кода (add32)

## Контекст
Функция `add32` определена в двух местах:
1. В `src/add32.ts` как основная реализация
2. В `src/index.ts` как inline функция для runtime проверки

Дублирование увеличивает размер бандла и усложняет поддержку.

## Цель
Удалить дублирование, оставив единую реализацию `add32` в `add32.ts`.

## Требуемые действия

### Шаг 1: Проанализировать текущее использование
1. Открыть `src/index.ts` и найти inline определение `add32`
2. Открыть `src/add32.ts` и посмотреть текущую реализацию
3. Проверить где еще используется `add32` в проекте

### Шаг 2: Удалить inline определение из index.ts
1. Открыть `src/index.ts`
2. Удалить блок кода с inline определением `add32`:
   ```typescript
   fn = function add32(x, y) {
     let lsw = (x & 0xffff) + (y & 0xffff);
     let msw = (x >> 16) + (y >> 16) + (lsw >> 16);
     return (msw << 16) | (lsw & 0xffff);
   };
   ```
3. Убедиться что импорт `add32` из `./add32` используется правильно

### Шаг 3: Обновить импорт в index.ts
1. Добавить импорт `add32` в `src/index.ts`:
   ```typescript
   import hex from './hex';
   import md51 from './md51';
   import add32 from './add32'; // Добавить этот импорт
   ```
2. Обновить логику проверки чтобы использовать импортированную `add32`

### Шаг 4: Оптимизировать реализацию add32
1. Открыть `src/add32.ts`
2. Сравнить две реализации (из add32.ts и из index.ts)
3. Выбрать более оптимальную реализацию или объединить лучшие части
4. Убедиться что реализация корректно работает с 32-битными числами

**Текущая реализация в add32.ts:**
```typescript
function add32(x: number, y: number): number {
  return (x + y) & 0xffffffff;
}
```

**Inline реализация из index.ts:**
```typescript
function add32(x, y) {
  let lsw = (x & 0xffff) + (y & 0xffff);
  let msw = (x >> 16) + (y >> 16) + (lsw >> 16);
  return (msw << 16) | (lsw & 0xffff);
}
```

### Шаг 5: Проверить корректность
1. Создать простой тест для `add32`
2. Проверить что функция корректно работает с большими числами
3. Убедиться что не происходит переполнения

### Шаг 6: Обновить зависимости
1. Проверить все файлы которые импортируют `add32`
2. Убедиться что импорты корректны
3. Запустить тесты чтобы проверить корректность

## Ожидаемый результат
- Единая реализация `add32` в `add32.ts`
- Удалено дублирование из `index.ts`
- Функциональность сохранена
- Размер бандла уменьшен

## Проверка прогресса
- [ ] Inline определение удалено из index.ts
- [ ] Добавлен импорт add32 в index.ts
- [ ] Реализация add32 оптимизирована (если нужно)
- [ ] Все импорты add32 обновлены
- [ ] Тесты проходят
- [ ] Сборка работает

## Примечания
1. Внимательно проверить работу с отрицательными числами
2. Убедиться что оптимизация не ломает логику MD5
3. Проверить производительность обеих реализаций

## Следующий шаг
После устранения дублирования перейти к Задаче 4: Вынос runtime проверки в compile-time.