# Задача 4: Вынос runtime проверки в compile-time

## Контекст
В `src/index.ts` есть runtime проверка корректности MD5:
```typescript
const check = hex(md51('hello'));
if (check !== '5d41402abc4b2a76b9719d911017c592') {
  // Определение add32 inline
}
```

Эта проверка:
1. Увеличивает размер бандла
2. Выполняется при каждом импорте библиотеки
3. Может быть вынесена в compile-time или тесты

## Цель
Убрать runtime проверку из основного кода, переместив её в тесты или compile-time проверки.

## Требуемые действия

### Шаг 1: Проанализировать текущую логику
1. Открыть `src/index.ts`
2. Понять полную логику проверки:
   - Проверяет что MD5('hello') дает правильный хеш
   - Если нет - определяет inline add32 с другой реализацией
   - Это fallback для некорректной реализации add32

### Шаг 2: Создать тест для проверки корректности
1. Открыть существующие тесты (`src/*.test.ts`)
2. Добавить тест для проверки MD5('hello')
3. Убедиться что тест покрывает тот же случай что и runtime проверка

**Пример теста:**
```typescript
test('MD5 should produce correct hash for "hello"', () => {
  expect(md5('hello')).toBe('5d41402abc4b2a76b9719d911017c592');
});
```

### Шаг 3: Удалить runtime проверку из index.ts
1. Удалить весь блок с проверкой из `src/index.ts`:
   ```typescript
   let fn;
   const check = hex(md51('hello'));
   if (check !== '5d41402abc4b2a76b9719d911017c592') {
     fn = function add32(x, y) {
       let lsw = (x & 0xffff) + (y & 0xffff);
       let msw = (x >> 16) + (y >> 16) + (lsw >> 16);
       return (msw << 16) | (lsw & 0xffff);
     };
   }
   ```
2. Упростить функцию `md5`:
   ```typescript
   function md5(string: string): string {
     return hex(md51(string));
   }
   ```

### Шаг 4: Обеспечить корректность add32
1. Убедиться что `add32.ts` содержит корректную реализацию
2. Проверить что все тесты проходят с текущей реализацией add32
3. Если нужно, обновить реализацию add32 для корректности

### Шаг 5: Добавить compile-time проверку (опционально)
1. Рассмотреть добавление TypeScript assertion
2. Или добавить проверку в процесс сборки
3. Или использовать константы которые проверяются TypeScript

### Шаг 6: Проверить сборку и тесты
1. Запустить `npm run build`
2. Проверить что сборка проходит без ошибок
3. Запустить `npm test`
4. Убедиться что все тесты проходят, включая новый тест

## Ожидаемый результат
- Runtime проверка удалена из основного кода
- Функциональность проверена через тесты
- Размер бандла уменьшен
- Производительность улучшена (нет лишних проверок)

## Проверка прогресса
- [ ] Создан тест для MD5('hello')
- [ ] Runtime проверка удалена из index.ts
- [ ] Функция md5 упрощена
- [ ] Реализация add32 проверена на корректность
- [ ] Сборка проходит без ошибок
- [ ] Все тесты проходят
- [ ] Размер бандла уменьшился

## Примечания
1. Убедиться что удаление проверки не ломает логику
2. Проверить что add32 работает корректно во всех случаях
3. Рассмотреть добавление дополнительных тестов для edge cases

## Риски
1. Если реализация add32 некорректна, тесты могут не выявить этого
2. Нужно убедиться что все use cases покрыты тестами

## Следующий шаг
После удаления runtime проверки перейти к Задаче 5: Оптимизация циклов и операций.